// -- Sammy -- /plugins/sammy.pure.js
// http://code.quirkey.com/sammy
// Version: 0.6.2
// Built: Mon Oct 11 12:41:47 -0700 2010
(function(c){
/*
  PURE Unobtrusive Rendering Engine for HTML

  Licensed under the MIT licenses.
  More information at: http://www.opensource.org

  Copyright (c) 2010 Michael Cvilic - BeeBole.com

  Thanks to Rog Peppe for the functional JS jump
  revision: 2.47
*/
var a,b=a=function(){var e=arguments[0],d=false;if(typeof e==="string"){d=arguments[1]||false}return a.core(e,d)};a.core=function(y,k,x){var x=m(),j=[];switch(typeof y){case"string":j=x.find(k||document,y);if(j.length===0){z('The template "'+y+'" was not found')}break;case"undefined":z("The template root is undefined, check your selector");break;default:j=[y]}for(var A=0,s=j.length;A<s;A++){x[A]=j[A]}x.length=s;var r="_s"+Math.floor(Math.random()*1000000)+"_",g="_a"+Math.floor(Math.random()*1000000)+"_",f=/^(\+)?([^\@\+]+)?\@?([^\+]+)?(\+)?$/,t={IMG:"src",INPUT:"value"},q=Array.isArray?function(i){return Array.isArray(i)}:function(i){return Object.prototype.toString.call(i)==="[object Array]"};return x;function z(i){if(typeof console!=="undefined"){console.log(i)}else{alert(i)}throw ("pure error: "+i)}function m(){var i=a.plugins,H=function(){};H.prototype=i;H.prototype.compile=i.compile||o;H.prototype.render=i.render||F;H.prototype.autoRender=i.autoRender||h;H.prototype.find=i.find||w;H.prototype._compiler=u;H.prototype._error=z;return new H()}function n(i){return i.outerHTML||(function(J){var I=document.createElement("div"),H;I.appendChild(J.cloneNode(true));H=I.innerHTML;I=null;return H})(i)}function d(i,H){return function(I){return i(""+H.call(I.context,I))}}function w(H,i){if(typeof H==="string"){i=H;H=false}if(typeof document.querySelectorAll!=="undefined"){return(H||document).querySelectorAll(i)}else{z("You can test PURE standalone with: iPhone, FF3.5+, Safari4+ and IE8+\n\nTo run PURE on your browser, you need a JS library/framework with a CSS selector engine")}}function e(H,i){return function(I){var M=[H[0]],P=H.length,J,O,L,N;for(var K=1;K<P;K++){J=i[K](I);O=H[K];if(J===""){L=M[M.length-1];if((N=L.search(/[\w]+=\"?$/))>-1){M[M.length-1]=L.substring(0,N);O=O.substr(1)}}M[M.length]=J;M[M.length]=O}return M.join("")}}function p(H){var i=H.match(/^(\w+)\s*<-\s*(\S+)?$/);if(i===null){z('bad loop spec: "'+H+'"')}if(i[1]==="item"){z('"item<-..." is a reserved word for the current running iteration.\n\nPlease choose another name for your loop.')}if(!i[2]||(i[2]&&(/context/i).test(i[2]))){i[2]=function(I){return I.context}}return{name:i[1],sel:i[2]}}function B(L){if(typeof(L)==="function"){return L}var H=L.match(/^[a-zA-Z\$_\@][\w\$:-]*(\.[\w\$:-]*[^\.])*$/);if(H===null){var K=false,J=L,N=[],O=[],I=0,M;if(/\'|\"/.test(J.charAt(0))){if(/\'|\"/.test(J.charAt(J.length-1))){M=J.substring(1,J.length-1);return function(){return M}}}else{while((H=J.match(/#\{([^{}]+)\}/))!==null){K=true;N[I++]=J.slice(0,H.index);O[I]=B(H[1]);J=J.slice(H.index+H[0].length,J.length)}}if(!K){z("bad data selector syntax: "+L)}N[I]=J;return e(N,O)}H=L.split(".");return function(P){var S=P.context;if(!S){return""}var Q=P[H[0]],R=0;if(Q&&Q.item){S=Q.item;R+=1}var T=H.length;for(;R<T;R++){if(!S){break}S=S[H[R]]}return(!S&&S!==0)?"":S}}function G(O,H,T){var K,W,N,S,I,R=[];if(typeof H==="string"){K=H;var M=H.match(f);if(!M){z("bad selector syntax: "+H)}W=M[1];N=M[2];S=M[3];I=M[4];if(N==="."||(!N&&S)){R[0]=O}else{R=x.find(O,N)}if(!R||R.length===0){return z('The node "'+H+'" was not found in the template')}}else{W=H.prepend;S=H.attr;I=H.append;R=[O]}if(W||I){if(W&&I){z("append/prepend cannot take place at the same time")}else{if(T){z("no append/prepend/replace modifiers allowed for loop target")}else{if(I&&T){z("cannot append with loop (sel: "+K+")")}}}}var U,L,i,V,J,P,Q;if(S){V=(/^style$/i).test(S);J=(/^class$/i).test(S);P=J?"className":S;U=function(Y,X){Y.setAttribute(g+S,X);if(P in Y&&!V){Y[P]=""}if(Y.nodeType===1){Y.removeAttribute(S);J&&Y.removeAttribute(P)}};if(V||J){if(V){L=function(X){return X.style.cssText}}else{L=function(X){return X.className}}i=function(X){return X.replace(/\"/g,"&quot;")}}else{L=function(X){return X.getAttribute(S)};i=function(X){return X.replace(/\"/g,"&quot;").replace(/\s/g,"&nbsp;")}}if(W){Q=function(Y,X){U(Y,X+L(Y))}}else{if(I){Q=function(Y,X){U(Y,L(Y)+X)}}else{Q=function(Y,X){U(Y,X)}}}}else{if(T){Q=function(Z,Y){var X=Z.parentNode;if(X){X.insertBefore(document.createTextNode(Y),Z.nextSibling);X.removeChild(Z)}}}else{if(W){Q=function(Y,X){Y.insertBefore(document.createTextNode(X),Y.firstChild)}}else{if(I){Q=function(Y,X){Y.appendChild(document.createTextNode(X))}}else{Q=function(Y,X){while(Y.firstChild){Y.removeChild(Y.firstChild)}Y.appendChild(document.createTextNode(X))}}}}i=function(X){return X}}return{attr:S,nodes:R,set:Q,sel:K,quotefn:i}}function D(I,K){var J=r+K+":";for(var H=0;H<I.nodes.length;H++){I.set(I.nodes[H],J)}}function v(H,J,i,K,I){return function(R){var T=J(R),N=R[H],V={items:T},Q=0,M,P=[],S=function(X,Y,Z,W){R.pos=Y.pos=X;R.item=Y.item=T[X];R.items=T;typeof W!=="undefined"&&(R.length=W);if(typeof Z==="function"&&Z(R)===false){Q++;return}P.push(i.call(Y,R))};R[H]=V;if(q(T)){M=T.length||0;if(typeof K==="function"){T.sort(K)}for(var O=0,U=M;O<U;O++){S(O,V,I,M-Q)}}else{if(T&&typeof K!=="undefined"){z("sort is only available on arrays, not objects")}for(var L in T){T.hasOwnProperty(L)&&S(L,V,I)}}typeof N!=="undefined"?R[H]=N:delete R[H];return P.join("")}}function l(N,L,P,T){var Q=false,O,V,K,J;for(J in P){if(P.hasOwnProperty(J)){if(J==="sort"){V=P.sort;continue}else{if(J==="filter"){K=P.filter;continue}}if(Q){z("cannot have more than one loop on a target")}O=J;Q=true}}if(!O){z("Error in the selector: "+L+"\nA directive action must be a string, a function or a loop(<-)")}var I=P[O];if(typeof(I)==="string"||typeof(I)==="function"){P={};P[O]={root:I};return l(N,L,P,T)}var S=p(O),H=B(S.sel),R=G(N,L,true),i=R.nodes;for(A=0;A<i.length;A++){var M=i[A],U=u(M,I);T[T.length]=d(R.quotefn,v(S.name,H,U,V,K));R.nodes=[M];D(R,T.length-1)}}function C(J,N){var S=J.getElementsByTagName("*"),P=[],V={a:[],l:{}},K,L,O,T,M,Q,I,R,U;for(O=-1,T=S.length;O<T;O++){I=O>-1?S[O]:J;if(I.nodeType===1&&I.className!==""){R=I.className.split(" ");for(M=0,Q=R.length;M<Q;M++){U=R[M];K=H(U,I.tagName);if(K!==false){L=(/nodevalue/i).test(K.attr);if(K.sel.indexOf("@")>-1||L){I.className=I.className.replace("@"+K.attr,"");if(L){K.attr=false}}P.push({n:I,cspec:K})}}}}return P;function H(ae,X){var aa=ae.match(f),ac=aa[3]||t[X],Z={prepend:!!aa[1],prop:aa[2],attr:ac,append:!!aa[4],sel:ae},ab,af,Y,ad,W;for(ab=V.a.length-1;ab>=0;ab--){Y=V.a[ab];ad=Y.l[0];W=ad&&ad[Z.prop];if(typeof W!=="undefined"){Z.prop=Y.p+"."+Z.prop;if(V.l[Z.prop]===true){W=W[0]}break}}if(typeof W==="undefined"){W=q(N)?N[0][Z.prop]:N[Z.prop];if(typeof W==="undefined"){return false}}if(q(W)){V.a.push({l:W,p:Z.prop});V.l[Z.prop]=true;Z.t="loop"}else{Z.t="str"}return Z}}function u(W,K,aa,O){var I=[];O=O||aa&&C(W,aa);if(aa){var T,X,J,P,Z,Q,ab,R,Y;while(O.length>0){J=O[0].cspec;P=O[0].n;O.splice(0,1);if(J.t==="str"){Z=G(P,J,false);D(Z,I.length);I[I.length]=d(Z.quotefn,B(J.prop))}else{ab=B(J.sel);Z=G(P,J,true);Q=Z.nodes;for(T=0,X=Q.length;T<X;T++){R=Q[T];Y=u(R,false,aa,O);I[I.length]=d(Z.quotefn,v(J.sel,ab,Y));Z.nodes=[R];D(Z,I.length-1)}}}}var Z,L;for(var S in K){if(K.hasOwnProperty(S)){L=K[S];if(typeof(L)==="function"||typeof(L)==="string"){Z=G(W,S,false);D(Z,I.length);I[I.length]=d(Z.quotefn,B(L))}else{l(W,S,L,I)}}}var V=n(W),H=[];V=V.replace(/<([^>]+)\s(value\=""|selected)\s?([^>]*)>/ig,"<$1 $3>");V=V.split(g).join("");var N=V.split(r),M;for(var U=1;U<N.length;U++){M=N[U];H[U]=I[parseInt(M,10)];N[U]=M.substring(M.indexOf(":")+1)}return e(N,H)}function o(J,H,I){var i=u((I||this[0]).cloneNode(true),J,H);return function(K){return i({context:K})}}function F(H,L){var K=typeof L==="function"?L:x.compile(L,false,this[0]);for(var I=0,J=this.length;I<J;I++){this[I]=E(this[I],K(H,false))}context=null;return this}function h(H,L){var K=x.compile(L,H,this[0]);for(var I=0,J=this.length;I<J;I++){this[I]=E(this[I],K(H,false))}context=null;return this}function E(K,H){var I,i=K.parentNode,J=0;switch(K.tagName){case"TBODY":case"THEAD":case"TFOOT":H="<TABLE>"+H+"</TABLE>";J=1;break;case"TR":H="<TABLE><TBODY>"+H+"</TBODY></TABLE>";J=2;break;case"TD":case"TH":H="<TABLE><TBODY><TR>"+H+"</TR></TBODY></TABLE>";J=3;break}tmp=document.createElement("SPAN");tmp.style.display="none";document.body.appendChild(tmp);tmp.innerHTML=H;I=tmp.firstChild;while(J--){I=I.firstChild}i.insertBefore(I,K);i.removeChild(K);document.body.removeChild(tmp);K=I;I=i=null;return K}};a.plugins={};a.libs={dojo:function(){if(typeof document.querySelector==="undefined"){a.plugins.find=function(e,d){return dojo.query(d,e)}}},domassistant:function(){if(typeof document.querySelector==="undefined"){a.plugins.find=function(e,d){return c(e).cssSelect(d)}}DOMAssistant.attach({publicMethods:["compile","render","autoRender"],compile:function(e,d){return a(this).compile(e,d)},render:function(d,e){return c(a(this).render(d,e))[0]},autoRender:function(d,e){return c(a(this).autoRender(d,e))[0]}})},jquery:function(){if(typeof document.querySelector==="undefined"){a.plugins.find=function(e,d){return jQuery(e).find(d)}}jQuery.fn.extend({compile:function(e,d){return a(this[0]).compile(e,d)},render:function(d,e){return jQuery(a(this[0]).render(d,e))},autoRender:function(d,e){return jQuery(a(this[0]).autoRender(d,e))}})},mootools:function(){if(typeof document.querySelector==="undefined"){a.plugins.find=function(e,d){return c(e).getElements(d)}}Element.implement({compile:function(e,d){return a(this).compile(e,d)},render:function(d,e){return a(this).render(d,e)},autoRender:function(d,e){return a(this).autoRender(d,e)}})},prototype:function(){if(typeof document.querySelector==="undefined"){a.plugins.find=function(e,d){e=e===document?e.body:e;return typeof e==="string"?$$(e):c(e).select(d)}}Element.addMethods({compile:function(e,f,d){return a(e).compile(f,d)},render:function(e,d,f){return a(e).render(d,f)},autoRender:function(e,d,f){return a(e).autoRender(d,f)}})},sizzle:function(){if(typeof document.querySelector==="undefined"){a.plugins.find=function(e,d){return Sizzle(d,e)}}},sly:function(){if(typeof document.querySelector==="undefined"){a.plugins.find=function(e,d){return Sly(d,e)}}}};(function(){var d=typeof dojo!=="undefined"&&"dojo"||typeof DOMAssistant!=="undefined"&&"domassistant"||typeof jQuery!=="undefined"&&"jquery"||typeof MooTools!=="undefined"&&"mootools"||typeof Prototype!=="undefined"&&"prototype"||typeof Sizzle!=="undefined"&&"sizzle"||typeof Sly!=="undefined"&&"sly";d&&a.libs[d]()})();Sammy=Sammy||{};Sammy.Pure=function(f,d){var e=function(g,h,i){return c(g).autoRender(h,i)};if(!d){d="pure"}f.helper(d,e)}})(jQuery);